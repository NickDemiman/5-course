# Пример использования реляционных БД в качестве источника данных для машинного обучения

## Задача:
Построить кластер достопримечательностей Москвы, ккоторые привлекают туристоов на отрезке $[t_1,t_2]$ (По фото, выложенными туристами).

### Схема бд:

![[Семинар 1_1.svg]]
$[t_1,t_2]$ - отрезок времени
$(x,y)$ - координаты кластера
r - число персон

$\rho = (S,P,SF)$

S - поставщики
***
SN - номер
SF - ФИО
SS - статус
SG - город

| SN  | SF      | SS  | SG     |
| --- | ------- | --- | ------ |
| S1  | Иванова | 80  | Москва |
| S2  | Петров  | 40  | Cамара |
| S3  | Кротов  | 100 | Москва | 

P - деталь
***
PN - номер детали
PF - назван
PC - единая`?` цена

| PN  | PF    | PC  |
| --- | ----- | --- |
| P1  | Болт  | 20  |
| P2  | Гайка | 25  |
| P3  | Шайба | 10  |
| P4  | Гайка | 35  | 

SF - поствака
***
SN - номер поставки
PN - номер детали
KOL - количество

| SN  | PN  | KOL |
| --- | --- | --- |
| S1  | P1  | 100 |
| S1  | P3  | 200 |
| S2  | P3  | 150 |
| S2  | P4  | 250 |
| S3  | P3  | 50  | 
***
$\pi_{A_1,\ldots,A_n}(r)$ - 
$\sigma_F(r)$ - 
$r_1 - r_2$ - 
$r_1 \cup r_2$ - 
$r_1 \Join r_2$ - 

## Спец. программа
### Условия
1)
```SQL
Select(G.idP, G.x, G.y)
from Персона P,
	 Фото F,
	 Геоточка G
where P.idP = G.idP and
	  P.idP = F.idP and
	  F.t between t1 and t2 and
	  G.t between t1 and t2 and
	  Город(G.x, G.y) = 'Москва'
into M(idP, x, y);
```

2)
$CL(x,y,r) = Cluster(M,Q)$

$(x,y)$ - координаты кластера
$r$ - число персон в кластере
$M$ - массив геоточек
$Q$ - число кластеров
$Cluster(M,Q)$

### Алгоритм
1. Выбрать $Q$ точек из $M$ и принять их как центры кластеров $(cx_i, cy_i)$

2. Построить $Q$ кластеров $C_i(cx_i,cy_i)$
$(idP_n,x_n,y_n) \in M$ попадает в кластер $C_i(cx_i,cy_i)$ если ее расстояние минимально.
$(idP_n,x_n,y_n) \in C_i(cx_i,cy_i)$: $(cx_i,cy_i) = arg$ $min$ $f((x_n,y_n), (cx_i,cy_i))$

3. $C_i$
$cx_i = \sum\limits_n\frac{x_n}{|c_i|}$,
$cy_i = \sum\limits_n\frac{y_n}{|c_i|}$
$(idP_n,x_n,y_n) \in C_i$

4. если $(idP_n,x_n,y_n) \in C_i$ , то перейти к 2 пункту
5. $c_i$          $idP$
В каждом кластере удаляем точки $idP$, $CL(x,y,r) = \{cx_i, cy_i, |c_i|\}$ (Тоесть удаляем дубликаты персон)

```SQL
for x in CL(x,y,r)
insert into Кластер
values(seq.nextval, :t1, :t2, :w.x, :w.y, :w.r)
```


## ДЗ
1. Найти поставщиков со статусом `> 70`
2. Найти номера и фамилии поставщиков со статусом `< 80`
3. Удалить поставки поставщика с `id = 1`
4. Найти номера поставщиков, поставляющих детали с ценой `< 30` 
5. Найти фамилии поставщиков, поставляющих шайбы с ценой (или кол-вом, хз не записал) `> 100`
6. Добавить новых поставщиков из таблицы `SNEW` в исходную(хз какая)

SNEW
| SN  |   SF    | SS  |   SG   |
|:---:|:-------:|:---:|:------:|
| S4  | Петров  | 30  | Тверь  |
| S5  | Сидоров | 50  | Тверь  |
| S1  |  Белов  | 160 | Москва | 

7. Все поставщики переехали с Москвы в СПБ (Нужно модифицировать S)
8. Для каждой задачи составить запрос и представить его на языке реляционной алгебры