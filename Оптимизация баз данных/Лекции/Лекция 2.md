[[Лекция 1 | Предыдущая лекция]]
# Операции реляционной алгебры

### 1. Объединенние двух отношений
$r = r_1 \cup r_2$ - это [[Термины#Отношение экземпляр отношений | отношение]], кортеж которого $\in$ или $r_1$ или $r_2$
$r = \frac{A_1}{1} \frac{A_2}{2}$; $r_2 = \frac{A_1}{5} \frac{A_2}{6}$
$r = r_1 \cup r_2 = \frac{A_1}{1(3,5)} \frac{A_2}{2(4,6)}$ ; (1 и 2 не может снова появиться, без дублей)

### 2. Разность отношений
Это отношение, каждый кортеж которого принадлежит $r_1$, но не пренадлежит $r_2$.
$r_1$ и $r_2$ должны обладать одинаковой [[Термины#Схема отношений | схемой отношений]]:
$r = r_1 - r_2$
$r = \frac{A_1}{3} \frac{A_2}{4}$

### 3. Пересечение отношения
$r = r_1 \cap r_2$ - отношение, каждый кортеж которого $\in$ и $r_1$, и $r_2$.
$r = r_1 \cap r_2 = \frac{A_1}{1} \frac{A_2}{2}$

### 4. Декартово произведение
Пусть R, S - некоторые схемы отношений;
r, s - соответственно экземпляры этих отношений, тогда $t = z \times s$ - декартово произведение, это есть отношение кортежа, который представляет собой конкетинацию $r..s$
$R = (A_1,A_2)$; $S=(A_1,A_3)$
$r = \frac{A_1}{1(3)} \frac{A_2}{2(4)}$; $s = \frac{A_1}{5(7)} \frac{A_3}{6(8)}$
$t = z$ x $s$ =
| $RA_1$ | $RA_2$ | $SA_1$ | $SA_2$ |
| :------: | :------: | :------: | :------: |
| 1      | 2      | 5      | 6      |
| 1      | 2      | 7      | 8      |
| 3      | 4      | 5      | 6      |
| 3      | 4      | 7      | 8      | 

### 5. Операция селекции
$t = \sigma_F(r)$ - отношение, каждый кортеж которого $\in$ z и удовлетворяет условию F
$r = \frac{A_1}{1(9,3)} \frac{A_2}{2(8,3)}$
$t = \sigma_(A_1 <= A_2)(r) = \frac{A_1}{1(3)} \frac{A_2}{2(3)}$

### 6. Операция проекции
$t = \pi_(A_1...A_n)(r)$, где $A_1...A_n$ - список атрибутов
Это отношение, каждый кортеж которого состоит из значений атрибутов исходного отношения; $r =$
| $A_1$ | $A_2$ | $A_3$ | $A_4$ |
|:-----:|:-----:|:-----:|:-----:|
|   1   |   2   |   3   |   4   |
|   7   |   8   |   9   |  10   |
|   3   |   4   |   5   |   6   |
|   3   |   4   |   7   |   6   | 
$\pi_(A_1,A_2)(r) = \frac{A_1}{1(7,3)} \frac{A_2}{2(8,4)}$

### 7. Естественное соединение
$t = r\Join s$ - $\Rightarrow$ из алгоритма его построения
1. строится декартово произведение

2. Выделяются:
$RA_(i1) = SA_(i1)$
...............................
$RA_(ik) = SA_(ik)$
Общие атрибуты схемы отношений r и s (Положение атрибутов в одинаковых позициях)

можно менять столбцы местами
3. Из отношения с шага 2 удалить дублирующиеся столбцы $SA_(ik) = SA_(ik)$

#### Пример
$R = (A_1, A_2, A_3)$; $S = (A_1, A_2, A_3)$ 
$r = \frac{A_1}{1(4)} \frac{A_2}{2(6)} \frac{A_3}{3(7)}$
$s = \frac{A_1}{1(8)} \frac{A_2}{2(9)} \frac{A_3}{7(10)}$
1. $r \times s$ = 
| $RA_1$ | $RA_2$ | $RA_3$ | $SA_1$ | $SA_2$ | $SA_4$ |
|:------:|:------:|:------:|:------:|:------:|:------:|
|   1    |   2    |   3    |   1    |   2    |   7    |
|   1    |   2    |   3    |   8    |   9    |   10   |
|   4    |   6    |   7    |   1    |   2    |   7    |
|   4    |   6    |   7    |   8    |   9    |   10   |
Находим совпадение столбцов по атрибутам - это $(RA_1, RA_2)$ и $(SA_1, SA_2)$
2. Находим совпадение параметров в строке и удаляем дубли
| $RA_1$ | $RA_2$ | $RA_3$ | $SA_1$ | $SA_2$ | $SA_4$ |
|:------:|:------:|:------:|:------:|:------:|:------:|
|  **1**   |  **2**   |   3    |  **1**   |  **2**   |   7    |
3. $A =$
| $A_1$ | $A_2$ | $A_3$ | $A_4$ |
|:-----:|:-----:|:-----:|:-----:|
|   1   |   2   |   3   |   7   | 

# Оптимизация схем БД
## Нормализация отношений
Фундаментальная зависимость - один ко многим
Пусть $R$ - универсальная схема отношений
$R = (A_1...A_n)$
$X \subseteq R$, $y \subseteq R$ - подмножество этой схемы отношений
$x \mapsto y$ - x функционально определяет y, если в любом экземпляре r со схемой R не существует двух кортежей совпадающих по x и не совпадающих по y
Если существует схема отношений r, такая, что в ней имеются по крайней мере два кортежа совпадают по x, но не совпадают по y $(x \cancel\mapsto y)$ - нет функц. зависимости

### Пример
R = (имя, адрес, товар, цена) = $(A_1, A_2, A_3, A_4)$
$\left.\begin{array}{ccc}A_1 \mapsto A_2\\A_2A_3 \mapsto A_4\\\end{array}\right\}F$
$r =$
| $A_1$  |  $A_2$   |  $A_3$   | $A_4$ |
|:------:|:--------:|:--------:|:-----:|
| ОАО'x' | M,ул.'y' | Карамель |  100  |
| ОАО'x' | M,ул.'y' |  Сахар   |  40   |
| ОАО'x' | M,ул.'y' | Пастила  |  140  |

Если в $\forall$ отношении нет совпадения по x, то будет иметь место $x \mapsto y$
$\underbrace{(A_1,A_3)}_{\text {нет совпадений}} \mapsto A_4$

$\left.\begin{array}{ccc}A_1 \mapsto A_2\\A_1A_3 \mapsto A_4\\\end{array}\right\}F$

Если x - книг $\Rightarrow$ [[Термины#ФЗ | ФЗ]]
R - универсальная схема отношений
F - множество функциональных зависимостей на этой схеме
Замыкание F называется множеством функциональных зависимостей, которые логически следуют из F $(F^+)$
[[Термины#ФЗ | ФЗ]] логически следует из F, если её можно получить с помощью Аксиом Армстронга.

### Аксиомы Арстронга
1. Рефлексивность
Если $x \subseteq y \subseteq R$, $y \mapsto x$ ^5a8e37

2. Пополнение
$x \mapsto y$, $z \subseteq R$
$x \cup z \mapsto y\cup z$
$(xz \mapsto yz)$, z может быть $\emptyset$

3. Транзитивность
Если $x \mapsto y$, $y \mapsto z$, то $x \mapsto z$
Исходные [[Термины#ФЗ | ФЗ]] выводится из Аксиом Армстронга, если в аксиоме 2: $z = \emptyset$

### Пример построения [[Термины#ЗМФЗ | ЗМФЗ]]
#### Условия
Пусть задана схема отношений:
$R = (A,B,C)$
$F = (A \mapsto B, B \mapsto C)$
$F^+ - ?$
#### Решение
1. $A \mapsto A$, $B \mapsto B$, $C \mapsto C$
$AB \mapsto A$, $AB \mapsto B$
$AC \mapsto A$, $AB \mapsto C$
$BC \mapsto C$, $BC \mapsto B$
$ABC \mapsto A$, $ABC \mapsto B$ $ABC \mapsto C$
$ABC \mapsto AB$, $ABC \mapsto AC$ $ABC \mapsto BC$
$ABC \mapsto ABC$
$AB \mapsto AB$, $AC \mapsto AC$, $BC \mapsto BC$
[[Термины#ФЗ | ФЗ]], полученное по аксиоме [[#^5a8e37 | Рефлексивности]] называется тривиальными

2. $A \mapsto AB$ (`ФЗ 1` пополняют атрибутами А)
$AC \mapsto BC$ (`ФЗ 1` пополняют атрибутами C)
$B \mapsto BC$ (`ФЗ 2` пополняют атрибутами B)
$AB \mapsto AC$ (`ФЗ 2` пополняют атрибутами A)
$AC \mapsto ABC$ (`ФЗ 1` пополняют атрибутами AC)
$AB \mapsto ABC$ (`ФЗ 2` пополняют атрибутами AB)

3. $A \mapsto C$ - так как появилось новая [[Термины#ФЗ | ФЗ]], возвращаемся к шагу 2

2. $AB \mapsto BC$ (пополняем B)
$A \mapsto AC$ (пополняем А)

3. $A \mapsto ABC$; $A \mapsto AB$; $AB \mapsto ABC$
Все полученные [[Термины#ФЗ | ФЗ]] $\in F^+$

### Лемма
Имеют место следующие правила:
1. Объединение
$x \mapsto y$ (1)
$x \mapsto z$ (2)
Следовательно имеет место: $x \mapsto yz$ (3)

2. Декомпозиция
$x \mapsto y$ (1)
$z \subseteq y$ (2)
Следовательно имеет место: $x \mapsto z$ (3)

3. Псевдотранзитивность
Если $x \mapsto y$ (1)
$w \mapsto z$ (2)
Следовательно имеет место: $wx \mapsto z$ (3)



