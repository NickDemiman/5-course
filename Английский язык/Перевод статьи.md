# Deep Lake

## Abstract
Традиционные озера данных обеспечивают критически важную инфраструктуру данных для аналитических процессов, позволяя перемещаться во времени, выполнять SQL запросы, получать данные с помощью транзакций ACID и визуализировать датасеты петабайтного масштаба в облачном хранилище.

Они позволяют организациям ликвидировать разрозненные хранилища данных, открыть возможности для принятия решений на основе данных., повысить операционную эффективность и сократить расходы.

Однако по мере того, как глубокое обучение берет верх над обычным аналитическими процессами, традиционные озера данных становятся менее полезными в таких областях, как обработка естественных языков (NLP), обработка звука, компьютерное зрение и в областях, вовлекающих нетабличные наборы данных.

Данная статья представляет Deep Lake, озеро данных для задач глубокого обучения с открытым исходным кодом, разработанным  на Activeloop. Deep Lake сохраняет преимущества стандартных озер данных с одной ключевой особенностью: оно хранит сложные данные, такие как изображения, видео, аннотации так же, как и табличные данные, в виде тензоров и быстро передает данные по сети в тензорный язык запросов, встроенный в браузер движок виртуализации или фреймворк глубокого обучения без ущерба использования GPU. Доступ к наборам данных, хранящимся в Deep Lake может быть получен при помощи PyTorch, TensorFlow, JAX.

## Introduction
Озеро данных - это центральный репозиторий, который дает организациям возможность хранить структурированные, неструктурированные и частично-структурированные данные в одном месте. Озера данных обеспечивают лучшие методы для управления и анализа данных. Вдобавок к этому, они дают возможность разбить хранилища данных и получить информацию, ранее скрытую в разрозненных источниках данных. Озера данных первого поколения традиционно хранили данные в распределенных хранилищах данных, таких как HDFS или AWS S3. Неорганизованные данные превратили озера данных в "болота данных", которые дали толчок к развитию озер данных второго поколения во главе с  Delta, Iceberg и Hudi. Они работают строго поверх стандартизированных структурированных форматов, таких как Parquet, ORC, Avro и представляют такие функции, как время в пути, транзакции ACID и эволюция схемы. Озера данных напрямую интегрируются с движками запросов, такими как Presto, Athena, Hive, Photon для обработки аналитических запросов. Также их можно подключить к фреймворкам типа Hadoop, Spark и Airflow для поддержки ETL пайплайнов. В свою очередь, интеграция озер данных с движками запросов с прозрачными вычислениями и распределенным хранением вылилось в появление таких систем, как Lakehouse, которые служат альтернативой хранилищам данных, таких как Snowflake, BigQuery, Redshit, Clickhouse.

За последнее десятилетие глубокое обучение опередило традиционные техники машинного обучения, вовлекающие неструктурированные и сложные данные, такие как текст, изображения, видео и аудио. Системы глубокого обучения не только переросли традиционные техники, но также достигли сверхчеловеческой точности в таких задачах, как определение рака по рентгеновским снимкам, анатомическая реконструкция нейронных клеток человека, игра в игры, вождение автомобиля, разворачивание белков и генерация изображений. Большие языковые модели с архитектурой, основанной на трансформациях, достигли высококлассных результатов в переводе, определении смысла, подведении итогов и дополнении текста. Большие мульти-модальные сети встраивают неструктурированные данные в векторы для кросс-модального поиска. Более того, они используются для создания фотореалистичных изображений из текста. Хотя одним из главных факторов успеха моделей глубокого обучения была доступность крупных датасетов, таких как CoCo, ImageNet, Oscar, LAION, они не имеют хорошо выстроенной инфраструктуры данных, схожей с традиционными аналитическими  рабочими нагрузками для поддержки такого машстаба. С другой стороны, в Modern Data Stack нет функций, необходимых для развертывания эффективных решений на базе глубокого обучения, поэтому организации выбрали разработку собственных систем.

В данной статье мы представляет Deep Lake, озеро данных разработанное специально для задач глубокого обучения. Deep Lake имеет преимущества традиционных озер данных с одним заметным отличие: оно хранит сложные данные типа изображений, видео, аннотаций и табличных данных в виде тензоров и обеспечивает быструю потоковую передачу данных в фреймворки глубокого обучения по сети без ущерба использования GPU. Более того, оно обеспечивает естественную совместимость между такими фреймворками для глубокого обучения, как PyTorch, TensorFlow и JAX.

Оставшаяся часть статьи разворачивается следующим образом. Мы начнем с рассмотрения текущих задач глубокого обучения на неструктурированных данных. Далее мы представим формат хранения Deep Lake и его ключевые концепты. Кроме того, мы обсудим возможности Deep Lake и его применение в цикле машинного обучения. Далее мы предоставим результаты экспериментов по прозводительности и обсудим результаты. В конце концов, мы рассмотрим связанные статьи, опишем возможные ограничения и сделаем выводы.

## Текущие задачи
В данном разделе мы обсудим текущие и исторические задачи по управлению неструктурированными и сложными данными.

### Сложные типы данных в базах данных
Есть 3 всеми признанных причины, почему blob или двоичные данные, такие как изображения, не должны храниться в БД. В первую очередь, базы данных обычно используют построчную архитектуру хранения. Поэтому выполнение запросов становится значительно медленнее, если строка содержит большое количество данных. Во вторых, сохранение данных в горячей памяти более затратно по сравнению с холодными хранением. И наконец, хранение изображений в оперативной памяти может быстро превысить емкость памяти и вызвать падение БД. По сути это делает широко используемые инфраструктуры данных неподходящими для обработки неструктурированных и сложных данных - по соображениям скорости, стоимости и надежности.

### Сложные данные с табличными форматами
Увеличение крупномашстабных аналитических и бизнес задач мотивировало разработку сжатых структурированных форматов типа Parquet, ORC, Avro, или временных по памяти форматов типа Arrow. По мере распространения табличных форматов, попытки разширить эти формат, такие как Petastorm или Feather для глубокого обучения, не увенчались успехом. Насколько нам известно, эти форматы так и не получили широкого распространения. Этот подход в первую очередь выигрывает от нативной интеграции с Modern Data Stack. Однако, как обсуждалось ранее, исходные инструкменты требуют фундаментальных изменений для адаптации к задачам глубокого обучения.

### Хранение объектов глубокого обучения
Текущее облачное решение для хранения большого количество неструктурированных данных это объектное хранилище типа AWS S3, Google Cloud Storage или MinIO. Объектное хранилище предлагает три главных преимущества по сравнению с распределенными файловыми системами. Они эффективны по затратам, расширяемы и являются независимыми от формата репозиториями. Однако, облачные хранилища не лишены недостатков. В первую очередь, это накладные задержки, особенно когда нужно обработать много небольших файлов типа текста или JSON. Далее - прием неструктурированных данных без контроля метаданных может породить "болота данных". Кроме того, объектные хранилища имеют встроенный контроль версий, которые используется редко в научных задачах. И наконец, данные в объектном хранилище копируются на виртуальную машину перед тренировкой, что опять же вызывает накладные расходы.

### Второе поколение озер данных
Второе поколение озер данных возглавили Delta, Iceberg, Hudi. Они обошли ограничения объектных хранилищ за счет управления файлами табличного формата со следующими основными свойствами. 
1. Операции изменения: вставка или удаление строки поверх файла табличного формата.
2. Потоковая передача: прием данных в нисходящем направлени со свойствами ACID и восходящая интеграция с движком запросов, раскрывающим интерфейс SQL.
3. Эволюция схемы: развивающаяся столбчатая структура с сохранением обратной совместимости
4. Перемещение во времени и отслеживание журнала аудита: сохранение исторического состояния с возможностью отката, при котором запросы могут быть воспроизведены. Также поддерживает контроль на уровне строк в происхождении данных.
5. Оптимизация структуры: встроенная функция для оптимизации размера файлов и сжатия данных с поддержкой заказа пользователя. Значительно ускоряет запросы.

Однако, озера данных второго поколения до сих пор ограничены собственными форматами данных, которые будут использоваться в глубоком обучении, как обсуждалось ранее в разделе 2.2. Поэтому в этой статье мы расширяем возможности озёр данных второго поколения для случаев глубокого обучения, переосмысливая формат и исходные функции, включая запросы, визуализацию и встроенную интеграцию с фреймворками глубокого обучения.

## 3. Формат хранения Deep Lake
Deep lake таблицы данных следуют столбчатой архитектуре хранилища с тензорами в качестве столбцов, как показано на Fig. 2. Каждый тензор это массив чанков - двоичных блобов, содержащих  экземпляры данных. Карта индексов, связанная с каждым тензором, помогает найти нужный чанк и индекс экземпляра в этом чанке для заданного индекса экземпляра.

### 3.1 Датасет
Экземпляр в датасете представляет собой одну строку, индексированную по параллельным тензорам. В отличие от формата хранения документов, экземпляры логически независимы, что дает возможность частичного доступа к ним во время выполнения требовательных запросов или потоковой передаче выбранных тензоров по сети к обучающим экземплярам GPU. Несколько тензоров могут быть сгруппированы. Группы реализуют синтаксическую вложенность и определяют отношения тензоров. Синтаксическая вложенность позволяет избежать усложнения формата для иерархической структуры памяти. Изменения в схеме датасета также отслеживаются по времени при помощи контроля версий, как и изменения в данных датасета.

### 3.2 Тензоры
Тензоры типизированы и могут быть дополнены или изменены. Доступ по умолчанию к индексу или набору индексов возвращает данные в виде массива NumPy. Вместо того, чтобы хранить одномерные данные, как было в Parquet или рядов, как в Arrow, тензоры могут хранить n-мерные данные, где первое измерение обычно индексное или пакетное. Тензоры могут хранить массивы динамически формируемые массивы, так называемые рваными тензорами, в отличие от других массивов со статическими фрагментами, как в Zarr.

### 3.3 Типы